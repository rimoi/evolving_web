# Evolving Web

I created this small project as an illustrative example of my coding approach using Symfony.

## Project Overview
The purpose of this project is to address a specific problem scenario. Imagine a situation where a user named SAM needs to populate his database using data from CSV files. To accomplish this, we have three CSV files that will be used to populate three distinct entities:

- Clustering Rules
- Fuel
- Segments

These files are located at the root of the project in the [Data](https://github.com/rimoi/evolving_web/tree/master/Data) folder.

## Technical stack
This project has been created with the following technologies :
  - Symfony (5.4)
  - PHP 8.0

## Installing the Project Locally
### Prerequisites
- Symfony CLI
- PHP, MYSQL, and Composer installed

### To Install the Project
```bash
git clone https://github.com/rimoi/evolving_web project_evolving
```

```bash
# Enter the 'project_evolving' folder generate with the previous command
cd project_evolving/ 

# Install dependencies
composer install 

# Create the .env.local.php file (remember to add your database connection credentials)
composer dump-env dev 

# Create the local database
bin/console doctrine:database:create

# Run the migration
bin/console doctrine:migrations:migrate

# Load fixtures
bin/console doctrine:fixtures:load

# Start the Symfony server in the background
symfony serve:start -d
```

After completing the previous steps, visit:

http://127.0.0.1:8000

For logging in, you can use the following account generated by fixtures:


| login          | password |
|----------------|----------|
| admin@demo.fr  | admin    |


Once logged in, the interface should be empty initially!

To populate your database, execute the following command:

```bash
bin/console app:import-cluster
```

Now, return to the dashboard, and you should have more data ðŸ˜‰

---

# What do we learn from this code?
> Clean code implies modular code, code that can evolve.

Let's take a look at the following two files:  
- [src/Service/Clusterisation/ClusterisationInterface.php](https://github.com/rimoi/evolving_web/blob/master/src/Service/Clusterisation/ClusterisationInterface.php)
- [src/Command/ImportClusterCommand.php](https://github.com/rimoi/evolving_web/blob/master/src/Command/ImportClusterCommand.php)

There are some important points to note. In the `ClusterisationInterface` file, we have added the `app.clustorisation_rules` tag to our interface:

```PHP
#[AutoconfigureTag('app.clustorisation_rules')]
interface ClusterisationInterface
{
    //...
}
```
This means that all services implementing this interface will be tagged with the `app.clustorisation_rules` tag.

Now, if we look at the constructor of `ImportClusterCommand`, we have the following:
```PHP
class ImportClusterCommand extends Command
{
    public function __construct(
        #[TaggedIterator('app.clustorisation_rules')]
        private iterable $clusterisationRules
    ) {
        parent::__construct(null);
    }
    
    // ...other code
}
```
This implies that the `$clusterisationRules` variable will receive all services that implement the `ClusterisationInterface`. This allows us to iterate over them and execute the execute function (line [37](https://github.com/rimoi/evolving_web/blob/master/src/Command/ImportClusterCommand.php#L37C38-L37C45))
which loads the entity from a CSV file.

What's great about all this is that if we want to add a new entity, we just need to follow these steps:

- Create the new entity
- Add the CSV file to be loaded in the [Data](https://github.com/rimoi/evolving_web/tree/master/Data) folder
- Create a service in the [src/Service/Clusterisation](https://github.com/rimoi/evolving_web/tree/master/src/Service/Clusterisation) directory that handles the file upload and implements the `ClusterisationInterface` contract
  And we don't need to change the logic in the `ImportClusterCommand` file at all.

**Note:** I have created an abstract class [AbstractClusterisation](https://github.com/rimoi/evolving_web/blob/master/src/Service/Clusterisation/AbstractClusterisation.php) that implements the  `ClusterisationInterface`
interface in order to factorize common code used by different subclasses. So, if you wish to implement the `ClusterisationInterface`, you should implement the abstract class [AbstractClusterisation](https://github.com/rimoi/evolving_web/blob/master/src/Service/Clusterisation/AbstractClusterisation.php).


## Conclusion : 
The advantage of this approach is that we have modular code. When we want to add the same logic for a new entity, we don't need to change the abstraction. Similarly, when we want to remove an entity, it doesn't require modifying the abstraction.